<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Ader's notebook" name="description"/>
<meta content="Ader" name="author"/>
<link href="https://ader817.github.io/notebook/algorithm/ads/ch1.html" rel="canonical"/>
<link href="ch0.html" rel="prev"/>
<link href="ch2.html" rel="next"/>
<link href="../../assets/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.34" name="generator"/>
<title>Chapter 1 | AVL Trees &amp; Splay Trees - Ader's notebook</title>
<link href="../../assets/stylesheets/main.35f28582.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775m1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25m13.274 9.537zl-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074M4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5M4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75M8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.5 4.5 0 0 1-.563-1.191 3.84 3.84 0 0 1-.05-2.063 4.65 4.65 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .75.75 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4 2.4 0 0 1-.507-.441 3.1 3.1 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19.01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.7 3.7 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.76 2.76 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6 6 0 0 0-.26.16 1 1 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1 1 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.61.61 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1 1 0 0 0-.34.398M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343za8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746m1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275M6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.75.75 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L6.94 8 4.97 6.03a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.25 1.25 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005 0-.009.004"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.5 3.5 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327q0 .15-.025.292c.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5q-.002.615-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A5 5 0 0 1 8 16a5 5 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5 5 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.7 1.7 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06m.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.17.17 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5m4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5m0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5M2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0"/></svg>');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono,+LXGW+WenKai+Screen+GB+Screen:300,300i,400,400i,700,700i%7CJetBrains+Mono,+Consolas:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"JetBrains Mono, LXGW WenKai Screen GB Screen";--md-code-font:"JetBrains Mono, Consolas"}</style>
<link href="../../css/heti.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/custom.css" rel="stylesheet"/>
<link href="https://unpkg.com/katex@0/dist/katex.min.css" rel="stylesheet"/>
<link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&amp;display=swap" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="blue-grey" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-1--avl-trees--splay-trees">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="Ader's notebook" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Ader's notebook">
<svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M.989 8 .064 2.68a1.342 1.342 0 0 1 1.85-1.462l13.402 5.744a1.13 1.13 0 0 1 0 2.076L1.913 14.782a1.343 1.343 0 0 1-1.85-1.463L.99 8Zm.603-5.288L2.38 7.25h4.87a.75.75 0 0 1 0 1.5H2.38l-.788 4.538L13.929 8Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Ader's notebook
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Chapter 1 | AVL Trees &amp; Splay Trees
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="切换至夜间模式" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="切换至夜间模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="切换至日间模式" class="md-option" data-md-color-accent="teal" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="切换至日间模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<a aria-label="分享" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="分享">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/Ader817/notebook/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    Ader817/notebook
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../index.html">
          
  
    
  
  Home

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../index.html">
          
  
    
  
  Algorithm

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../software/index.html">
          
  
    
  
  Software

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../system/index.html">
          
  
    
  
  System

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../math/index.html">
          
  
    
  
  Math

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../writeups/index.html">
          
  
    
  
  Writeups

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Ader's notebook" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Ader's notebook">
<svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M.989 8 .064 2.68a1.342 1.342 0 0 1 1.85-1.462l13.402 5.744a1.13 1.13 0 0 1 0 2.076L1.913 14.782a1.343 1.343 0 0 1-1.85-1.463L.99 8Zm.603-5.288L2.38 7.25h4.87a.75.75 0 0 1 0 1.5H2.38l-.788 4.538L13.929 8Z"></path></svg>
</a>
    Ader's notebook
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/Ader817/notebook/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    Ader817/notebook
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../index.html">
<span class="md-ellipsis">
    Home
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../index.html">
<span class="md-ellipsis">
    Algorithm
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Algorithm
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="index.html">
<span class="md-ellipsis">
    高级数据结构与算法分析
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            高级数据结构与算法分析
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
<span class="md-ellipsis">
    Balanced Search Trees
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_2">
<span class="md-nav__icon md-icon"></span>
            Balanced Search Trees
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="ch0.html">
<span class="md-ellipsis">
    Chapter 0 | Amortized Analysis
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Chapter 1 | AVL Trees &amp; Splay Trees
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="ch1.html">
<span class="md-ellipsis">
    Chapter 1 | AVL Trees &amp; Splay Trees
  </span>
</a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#avl-树">
<span class="md-ellipsis">
      AVL 树
    </span>
</a>
<nav aria-label="AVL 树" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#概念">
<span class="md-ellipsis">
      概念
    </span>
</a>
<nav aria-label="概念" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#avl-树_1">
<span class="md-ellipsis">
      AVL 树
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#视角">
<span class="md-ellipsis">
      视角
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#操作">
<span class="md-ellipsis">
      操作
    </span>
</a>
<nav aria-label="操作" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ll--rr">
<span class="md-ellipsis">
      LL &amp; RR
    </span>
</a>
<nav aria-label="LL &amp; RR" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#旋转视角">
<span class="md-ellipsis">
      “旋转”视角
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#换根视角">
<span class="md-ellipsis">
      “换根”视角
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lr--rl">
<span class="md-ellipsis">
      LR &amp; RL
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#avl-树的删除">
<span class="md-ellipsis">
      *AVL 树的删除
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#splay-树">
<span class="md-ellipsis">
      Splay 树
    </span>
</a>
<nav aria-label="Splay 树" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#基本操作">
<span class="md-ellipsis">
      基本操作
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#对点操作">
<span class="md-ellipsis">
      对点操作
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#摊还分析">
<span class="md-ellipsis">
      摊还分析
    </span>
</a>
<nav aria-label="摊还分析" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#zig">
<span class="md-ellipsis">
      zig
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zig-zag">
<span class="md-ellipsis">
      zig-zag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zig-zig">
<span class="md-ellipsis">
      zig-zig
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#结论">
<span class="md-ellipsis">
      结论
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="ch2.html">
<span class="md-ellipsis">
    Inverted Index
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="ch3.html">
<span class="md-ellipsis">
    Heaps
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="ch5.html">
<span class="md-ellipsis">
    Algorithms
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="problem.html">
<span class="md-ellipsis">
    Problem Set
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../software/index.html">
<span class="md-ellipsis">
    Software
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../system/index.html">
<span class="md-ellipsis">
    System
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../math/index.html">
<span class="md-ellipsis">
    Math
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../writeups/index.html">
<span class="md-ellipsis">
    Writeups
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#avl-树">
<span class="md-ellipsis">
      AVL 树
    </span>
</a>
<nav aria-label="AVL 树" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#概念">
<span class="md-ellipsis">
      概念
    </span>
</a>
<nav aria-label="概念" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#avl-树_1">
<span class="md-ellipsis">
      AVL 树
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#视角">
<span class="md-ellipsis">
      视角
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#操作">
<span class="md-ellipsis">
      操作
    </span>
</a>
<nav aria-label="操作" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ll--rr">
<span class="md-ellipsis">
      LL &amp; RR
    </span>
</a>
<nav aria-label="LL &amp; RR" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#旋转视角">
<span class="md-ellipsis">
      “旋转”视角
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#换根视角">
<span class="md-ellipsis">
      “换根”视角
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lr--rl">
<span class="md-ellipsis">
      LR &amp; RL
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#avl-树的删除">
<span class="md-ellipsis">
      *AVL 树的删除
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#splay-树">
<span class="md-ellipsis">
      Splay 树
    </span>
</a>
<nav aria-label="Splay 树" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#基本操作">
<span class="md-ellipsis">
      基本操作
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#对点操作">
<span class="md-ellipsis">
      对点操作
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#摊还分析">
<span class="md-ellipsis">
      摊还分析
    </span>
</a>
<nav aria-label="摊还分析" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#zig">
<span class="md-ellipsis">
      zig
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zig-zag">
<span class="md-ellipsis">
      zig-zag
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zig-zig">
<span class="md-ellipsis">
      zig-zig
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#结论">
<span class="md-ellipsis">
      结论
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/Ader817/notebook/edit/master/docs/algorithm/ads/ch1.md" title="编辑此页">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/Ader817/notebook/raw/master/docs/algorithm/ads/ch1.md" title="查看本页的源代码">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg>
</a>
<h1 id="chapter-1--avl-trees--splay-trees">Chapter 1 | AVL Trees &amp; Splay Trees</h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约<span class="heti-skip"><span class="heti-spacing"> </span>7236<span class="heti-spacing"> </span></span>个字 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"></path></svg></span> <span>9<span class="heti-spacing"> </span></span>张图片 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间<span class="heti-skip"><span class="heti-spacing"> </span>48<span class="heti-spacing"> </span></span>分钟</p>
</div>
<div class="admonition tip">
<p class="admonition-title">阅读技巧</p>
<p>因为没法在这里用代码写动画，所以我用<a href="https://facelessuser.github.io/pymdown-extensions/extensions/tabbed/?h=%3D%3D%3D#tabbed"><span class="heti-skip"><span class="heti-spacing"> </span>Tab<span class="heti-spacing"> </span></span></a>模拟了一下动画帧，可以手动切换这些标签来动态观察。一般这种内容的<span class="heti-skip"><span class="heti-spacing"> </span>Tab<span class="heti-spacing"> </span></span>标题都会是 <code>Frame {}</code>。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"/><input id="__tabbed_1_2" name="__tabbed_1" type="radio"/><input id="__tabbed_1_3" name="__tabbed_1" type="radio"/><div class="tabbed-labels"><label for="__tabbed_1_1">Frame 1</label><label for="__tabbed_1_2">Frame 2</label><label for="__tabbed_1_3">Frame 3</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Like</p>
</div>
<div class="tabbed-block">
<p>Like this</p>
</div>
<div class="tabbed-block">
<p>Like this!</p>
</div>
</div>
</div>
</div>
<h2 id="avl-树"><span>AVL<span class="heti-spacing"> </span></span>树</h2>
<h3 id="概念">概念</h3>
<div class="admonition quote">
<p class="admonition-title">link</p>
<p>OI Wiki: <a href="https://oi-wiki.org/ds/avl/">https://oi-wiki.org/ds/avl/</a></p>
</div>
<p>我们知道，对于一棵二叉搜索树，其对点的操作代价为<span><span class="heti-spacing"> </span><span class="arithmatex">\(O(\log n)\)</span></span>。然而在最坏情况下，它会退化成<span><span class="heti-spacing"> </span><span class="arithmatex">\(O(n)\)</span></span>，例如这是一棵只有左孩子树的链型二叉树，那么操作这里唯一的叶孩子节点就是<span><span class="heti-spacing"> </span><span class="arithmatex">\(O(n)\)</span></span>。</p>
<p>换句话来说，一棵二叉树的维护成本基本上与其高度正相关。因而一个很自然的想法是，如果我们想让一棵二叉树好维护，那么就希望它的高度尽可能低，而在点数固定的情况下，一种朴素的思想是让节点尽可能“均匀”地分布在树上。</p>
<div class="admonition definition">
<p class="admonition-title">height of a tree</p>
<p><strong>树的高度<span><span class="heti-spacing"> </span>(Height of Tree)</span></strong>等于其根节点到叶孩子节点的若干路径中，最大的距离（即边的数量<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，也就是深度最深的节点到根节点到距离。</p>
<p>特别的，一棵空树的高度为<span><span class="heti-spacing"> </span>-1</span>。</p>
<blockquote>
<p>说的通俗一些，就是树的层数。</p>
</blockquote>
</div>
<hr/>
<h4 id="avl-树_1"><span>AVL<span class="heti-spacing"> </span></span>树</h4>
<p>而<span class="heti-skip"><span class="heti-spacing"> </span>AVL Tree<span class="heti-spacing"> </span></span>是一种<strong>平衡<span><span class="heti-spacing"> </span>(balanced)</span></strong>的二叉搜索树，通过「高度」这个量，定义了「平衡」这件事。</p>
<div class="admonition definition">
<p class="admonition-title">AVL Tree</p>
<ol>
<li>一个空二叉树是一个<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树；</li>
<li>如果二叉树<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T\)</span><span class="heti-spacing"> </span></span>是一个<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树，则其左右孩子树<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T_l\)</span><span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T_r\)</span><span class="heti-spacing"> </span></span>也都应该是<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树，且有<span><span class="heti-spacing"> </span><span class="arithmatex">\(|h(T_l) - h(T_r)| \leq 1\)</span></span>；</li>
</ol>
<div class="admonition definition">
<p class="admonition-title">Balance Factor</p>
<p>一个节点的<strong>平衡因子<span><span class="heti-spacing"> </span>(Balance Factor, BF)</span></strong>用来描述一个节点的平衡状态，对于节点<span><span class="heti-spacing"> </span><span class="arithmatex">\(T_p\)</span></span>，它的左孩子树为<span><span class="heti-spacing"> </span><span class="arithmatex">\(T_l\)</span></span>，右孩子树为<span><span class="heti-spacing"> </span><span class="arithmatex">\(T_r\)</span></span>，则：</p>
<div class="arithmatex">\[
BF(T_p) = h(T_l) - h(T_r)
\]</div>
</div>
<p>所以上面的第<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>条又可以写成：</p>
<ul>
<li>如果二叉树<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T\)</span><span class="heti-spacing"> </span></span>是一个<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树，则其左右孩子树<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T_l\)</span><span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T_r\)</span><span class="heti-spacing"> </span></span>也都应该是<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树，且有<span><span class="heti-spacing"> </span><span class="arithmatex">\(BF(T_p) \in \{0, \pm 1\}\)</span></span>；</li>
</ul>
<blockquote>
<p>说的通俗一些就是，<span>AVL<span class="heti-spacing"> </span></span>树的每一个点都平衡，而平衡与否取决于节点的两个孩子树层数之差是否超过<span><span class="heti-spacing"> </span>1</span>。</p>
</blockquote>
</div>
<p>在这种定义下，<span>AVL<span class="heti-spacing"> </span></span>树的高度可以证明为<span><span class="heti-spacing"> </span><span class="arithmatex">\(O(\log N)\)</span></span>，证明如下：</p>
<div class="admonition proof">
<p class="admonition-title">Height of AVL Trees</p>
<div class="admonition inline note">
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>graph TD;
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>A(("Root"))
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>B[/"Left Subtree"\]
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>C[/"Right Subtree"\]
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>A === B
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>A === C
</span></code></pre></div>
</div>
<p>我们记<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(n_h\)</span><span class="heti-spacing"> </span></span>是高度为<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(h\)</span><span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树所包含的最少节点数，则有如下递推关系：</p>
<div class="arithmatex">\[
n_h = \left\{
    \begin{array}{l}
        1                       &amp; (h = 0) \\
        2                       &amp; (h = 1) \\
        n_{h-1} + n_{h-2} + 1   &amp; (h &gt; 1)
    \end{array}
\right.
\]</div>
<p>发现<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(n_h + 1\)</span><span class="heti-spacing"> </span></span>符合<span class="heti-skip"><span class="heti-spacing"> </span>Fibonacci<span class="heti-spacing"> </span></span>数列的递推公式（但是初始条件不一样<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，所以我们可以用<span class="heti-skip"><span class="heti-spacing"> </span>Fibonacci<span class="heti-spacing"> </span></span>对其进行一个估计。</p>
<p>而对于如下<span class="heti-skip"><span class="heti-spacing"> </span>Fibonacci<span class="heti-spacing"> </span></span>数列：</p>
<div class="arithmatex">\[
F_i = \left\{
    \begin{array}{l}
        1                   &amp; (i = 1) \\
        1                   &amp; (i = 2) \\
        F_{i-1} + F_{i-2}   &amp; (i &gt; 2)
    \end{array}
\right.
\]</div>
<p>其通项为：</p>
<div class="arithmatex">\[
\begin{aligned}
    F_n &amp;= \frac{1}{\sqrt{5}} \left( \left( \frac{1 + \sqrt{5}}{2} \right)^n - \left( \frac{1 - \sqrt{5}}{2} \right)^n \right) \\
        &amp;\approx \frac{1}{\sqrt{5}} \left( \frac{1 + \sqrt{5}}{2} \right)^n \\
    \log{(F_n)} &amp;\approx n
\end{aligned}
\]</div>
<p>而<span><span class="heti-spacing"> </span><span class="arithmatex">\(n_h + 1 \approx F_{h+2}\)</span></span>，所以<span><span class="heti-spacing"> </span><span class="arithmatex">\(h \approx \log{(n_h)}\)</span></span>，也就是说<span><span class="heti-spacing"> </span><span class="arithmatex">\(h \approx \log{N}\)</span></span>。</p>
</div>
<hr/>
<h4 id="视角">视角</h4>
<p>而我们谈论<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树时，我们希望以一个动态的视角来谈论<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树，即讨论：某一棵树是否是<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树；在某个操作后，它是否仍然是<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树；若原先是，而经过操作后不再是，那要如何将它重新变为<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树。</p>
<p>以上三个步骤是简化后的建模，它成为我们解决其他问题的最小单元和基础。</p>
<p>所以在这种模型下，我们需要定义两个东西：</p>
<div class="admonition definition">
<p class="admonition-title">Trouble Maker &amp; Trouble Finder</p>
<p>以 🌰 来说明。</p>
<div class="admonition note">
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"/><input id="__tabbed_2_2" name="__tabbed_2" type="radio"/><div class="tabbed-labels"><label for="__tabbed_2_1">Frame 1</label><label for="__tabbed_2_2">Frame 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>下图为一个<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>graph TD;
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>A(("8, BF=1"))
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>B(("4, BF=0"))
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>C(("9, BF=0"))
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>D(("2, BF=0"))
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>E(("6, BF=0"))
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>A === B
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>A === C
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>B === D
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>B === E
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p>现在我们插入 <code>5</code>：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>graph TD;
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>A(("8, BF=2"))
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>B(("4, BF=-1"))
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>C(("9, BF=0"))
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>D(("2, BF=0"))
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>E(("6, BF=1"))
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>F(("5, BF=0"))
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>A === B
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>A === C
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>B === D
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>B === E
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>E === F
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a>E === NULL
</span></code></pre></div>
<p>我们发现，此时 <code>8</code> 的「平衡因子」变成了<span><span class="heti-spacing"> </span>2</span>，不再符合<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树的要求，而这一切都是 <code>5</code> 的插入导致的——于是我们称像这里的 <code>8</code> 一样，由于某个点的插入，其「平衡因子」不再符合要求的点，为<span><span class="heti-spacing"> </span>Trouble Finder</span>；而像这里的 <code>5</code> 一样，导致<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>出现的点，被称之为<span><span class="heti-spacing"> </span>Trouble Maker</span>。</p>
</div>
</div>
</div>
</div>
<p>形象地描述这件事就是，在动态插入 <code>5</code> 这个过程中，出现了一个<span><span class="heti-spacing"> </span>"Trouble"</span>，导致这个树不再是<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树，而 <code>5</code> 是这个<span class="heti-skip"><span class="heti-spacing"> </span>"Trouble"<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>"Maker"</span>，<code>8</code> 是<span><span class="heti-spacing"> </span>"Finder"</span>。</p>
</div>
<hr/>
<h3 id="操作">操作</h3>
<p>本小节所需要讲的内容就是<strong><a href="#视角"><span>#<span class="heti-spacing"> </span></span>视角</a></strong>中提到的“重新变为<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树”这一视角，也就是<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树的维护。</p>
<p>首先， 我们需要对<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树的破坏情况进行分类，根据<span><span class="heti-spacing"> </span>"Trouble Finder"</span>、"Related Trouble Finder's Child"、<span>"Trouble Maker"<span class="heti-spacing"> </span></span>这三个点的相对关系，分为 <code>LL</code>、<code>RR</code>、<code>LR</code>、<code>RL</code> 四种：</p>
<div class="admonition note">
<blockquote>
<p>同心圆表示这个点是需要我们在后续操作中关注的。</p>
<p>此外，虽然实际情况下可能出现多个<span><span class="heti-spacing"> </span>Trouble Finder</span>，但是我们只关注<strong>以「距离案发现场最近的<span><span class="heti-spacing"> </span>Trouble Finder</span>」为根的孩子树</strong>（这句话非常重要<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"/><input id="__tabbed_3_2" name="__tabbed_3" type="radio"/><input id="__tabbed_3_3" name="__tabbed_3" type="radio"/><input id="__tabbed_3_4" name="__tabbed_3" type="radio"/><div class="tabbed-labels"><label for="__tabbed_3_1">LL</label><label for="__tabbed_3_2">RR</label><label for="__tabbed_3_3">LR</label><label for="__tabbed_3_4">RL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>flowchart TD
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>    A((("Trouble Finder")))
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>    B((("Left Child")))
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>    C(("Right Child"))
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>    D(("L Left Child"))
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>    DA[/"Left and Right Subtrees"\]
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>    E(("L Right Child"))
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>    EA[/"Left and Right Subtrees"\]
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>    F(("R Left Child"))
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>    FA[/"Left and Right Subtrees"\]
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>    G(("R Right Child"))
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>    GA[/"Left and Right Subtrees"\]
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>    H(("Trouble Maker"))
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>    A === B
</span><span id="__span-3-15"><a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>    A === C
</span><span id="__span-3-16"><a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a>    B === D === DA === H
</span><span id="__span-3-17"><a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a>    B === E === EA
</span><span id="__span-3-18"><a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a>    C === F === FA
</span><span id="__span-3-19"><a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a>    C === G === GA
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>flowchart TD
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>    A((("Trouble Finder")))
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>    B(("Left Child"))
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>    C((("Right Child")))
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>    D(("L Left Child"))
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>    DA[/"Left and Right Subtrees"\]
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>    E(("L Right Child"))
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>    EA[/"Left and Right Subtrees"\]
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>    F(("R Left Child"))
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>    FA[/"Left and Right Subtrees"\]
</span><span id="__span-4-11"><a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>    G(("R Right Child"))
</span><span id="__span-4-12"><a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>    GA[/"Left and Right Subtrees"\]
</span><span id="__span-4-13"><a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a>    H(("Trouble Maker"))
</span><span id="__span-4-14"><a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a>    A === B
</span><span id="__span-4-15"><a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a>    A === C
</span><span id="__span-4-16"><a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a>    B === D === DA
</span><span id="__span-4-17"><a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a>    B === E === EA
</span><span id="__span-4-18"><a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a>    C === F === FA
</span><span id="__span-4-19"><a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a>    C === G === GA === H
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>flowchart TD
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>    A((("Trouble Finder")))
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>    B((("Left Child")))
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>    C(("Right Child"))
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>    D(("L Left Child"))
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>    DA[/"Left and Right Subtrees"\]
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>    E((("L Right Child")))
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>    EA[/"Left and Right Subtrees"\]
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>    F(("R Left Child"))
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>    FA[/"Left and Right Subtrees"\]
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>    G(("R Right Child"))
</span><span id="__span-5-12"><a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>    GA[/"Left and Right Subtrees"\]
</span><span id="__span-5-13"><a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>    H(("Trouble Maker"))
</span><span id="__span-5-14"><a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>    A === B
</span><span id="__span-5-15"><a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>    A === C
</span><span id="__span-5-16"><a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a>    B === D === DA
</span><span id="__span-5-17"><a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a>    B === E === EA === H
</span><span id="__span-5-18"><a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a>    C === F === FA
</span><span id="__span-5-19"><a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a>    C === G === GA
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>flowchart TD
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>    A((("Trouble Finder")))
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>    B(("Left Child"))
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    C((("Right Child")))
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>    D(("L Left Child"))
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>    DA[/"Left and Right Subtrees"\]
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>    E(("L Right Child"))
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>    EA[/"Left and Right Subtrees"\]
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>    F((("R Left Child")))
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>    FA[/"Left and Right Subtrees"\]
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a>    G(("R Right Child"))
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a>    GA[/"Left and Right Subtrees"\]
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>    H(("Trouble Maker"))
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>    A === B
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a>    A === C
</span><span id="__span-6-16"><a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>    B === D === DA
</span><span id="__span-6-17"><a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a>    B === E === EA
</span><span id="__span-6-18"><a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a>    C === F === FA === H
</span><span id="__span-6-19"><a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a>    C === G === GA
</span></code></pre></div>
</div>
</div>
</div>
<p>稍作解释，例如 <code>LR</code>，表示的是<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Maker<span class="heti-spacing"> </span></span>在<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>L<span class="heti-spacing"> </span></span>孩子节点的<span class="heti-skip"><span class="heti-spacing"> </span>R<span class="heti-spacing"> </span></span>孩子树中。</p>
<p>另外，对于我只在 <code>LR</code> 和 <code>RL</code> 中着重二级孩子节点，并不是笔误。之后会详细介绍。</p>
</div>
<hr/>
<h4 id="ll--rr">LL &amp; RR</h4>
<div class="admonition tip">
<p class="admonition-title">废话</p>
<p>大部分教材都倾向于继续用“旋转”来概括这些方法，确实其实从抽象角度来讲至少 <code>LL</code> 和 <code>RR</code> 部分也还是像的，但是我觉得这并不利于记忆和理解这个过程，尤其是对于 <code>LR</code> 和 <code>RL</code> 的部分。</p>
<p>所以在 <code>LL</code> 和 <code>RR</code> 部分，我还是会先介绍一下比较传统的，用“旋转”的方式来理解，之后我将尝试着用我自己的思路来讲。</p>
</div>
<h5 id="旋转视角">“旋转”视角</h5>
<p><code>LL</code> 和 <code>RR</code> 这两种情况相对直观。由于它们的操作是对称的，所以我这里以 <code>LL</code> 为例。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>    flowchart TD
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>        A((("Trouble Finder")))
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>        C[/"Right Subtree"\]
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>        subgraph SA["New Left Subtree"]
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>            subgraph SB["New L Left Subtree"]
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>                D[/"L Left Subtree"\]
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>                H(("Trouble Maker"))
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>            end
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>            B((("Left Child")))
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a>            E[/"L Right Subtree"\]
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a>        end
</span><span id="__span-7-15"><a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a>
</span><span id="__span-7-16"><a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a>        A === B
</span><span id="__span-7-17"><a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a>        A === C
</span><span id="__span-7-18"><a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a>        B === D === H
</span><span id="__span-7-19"><a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a>        B === E
</span></code></pre></div>
<p>根据相关性质，我们得到这个模型有如下性质：</p>
<div class="admonition property">
<p class="admonition-title">一些性质</p>
<ol>
<li><span class="arithmatex">\(BF(\text{Trouble Finder}) = h(\text{New Left Subtree}) - h(\text{Right Subtree}) = 2\)</span>；</li>
<li><span class="arithmatex">\(h(\text{New L Left Subtree}) - h(\text{L Right Subtree}) = 1\)</span>；<ul>
<li>如果此差为<span><span class="heti-spacing"> </span>0</span>，则不应当成为<span><span class="heti-spacing"> </span>Trouble Maker</span>，若此差为<span><span class="heti-spacing"> </span>2</span>，则<span class="heti-skip"><span class="heti-spacing"> </span>Left Child<span class="heti-spacing"> </span></span>应当为<span><span class="heti-spacing"> </span>Trouble Finder</span>；</li>
</ul>
</li>
</ol>
</div>
<p>现在我们希望在保留二叉搜索树的性质下，要让<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(|BF(\text{Trouble Finder})|\)</span><span class="heti-spacing"> </span></span>变小，一个很自然的想法就是让<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(h(\text{New Left Subtree})\)</span><span class="heti-spacing"> </span></span>去<span><span class="heti-spacing"> </span>-1</span>，让<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(h(\text{Right Subtree})\)</span><span class="heti-spacing"> </span></span>去<span><span class="heti-spacing"> </span>+1</span>。</p>
<p>于是我们发现，这样的操作刚好：</p>
<div class="admonition section">
<p class="admonition-title">LL Single Rotation</p>
<blockquote>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>Frame 2<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>Frame 3<span class="heti-spacing"> </span></span>之间添加的细线是为了表示这里<span class="heti-skip"><span class="heti-spacing"> </span>L Right Subtree<span class="heti-spacing"> </span></span>的转移方法，让<span class="heti-skip"><span class="heti-spacing"> </span>2 ~ 3<span class="heti-spacing"> </span></span>帧的“旋转”过程中更加清晰。</p>
<p>此外，这里要素的命名都是基于<span class="heti-skip"><span class="heti-spacing"> </span>Frame 1<span class="heti-spacing"> </span></span>的，对于<span class="heti-skip"><span class="heti-spacing"> </span>Frame 4<span class="heti-spacing"> </span></span>来说<span class="heti-skip"><span class="heti-spacing"> </span>L Right Subtree<span class="heti-spacing"> </span></span>显然已经不是<span class="heti-skip"><span class="heti-spacing"> </span>L Right Subtree<span class="heti-spacing"> </span></span>了。</p>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="4:4"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio"/><input id="__tabbed_4_2" name="__tabbed_4" type="radio"/><input id="__tabbed_4_3" name="__tabbed_4" type="radio"/><input id="__tabbed_4_4" name="__tabbed_4" type="radio"/><div class="tabbed-labels"><label for="__tabbed_4_1">Frame 1</label><label for="__tabbed_4_2">Frame 2</label><label for="__tabbed_4_3">Frame 3</label><label for="__tabbed_4_4">Frame 4</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>    flowchart TD
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>        A((("Trouble Finder")))
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>        B((("Left Child")))
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>        D[/"L Left Subtree"\]
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>        H(("Trouble Maker"))
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>        E[/"L Right Subtree"\]
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a>        A === B
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>        A === C
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a>        B === D === H
</span><span id="__span-8-12"><a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a>        B === E
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>    flowchart TD
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>        A((("Trouble Finder")))
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>        B((("Left Child")))
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>        D[/"L Left Subtree"\]
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>        E[/"L Right Subtree"\]
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>        H(("Trouble Maker"))
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>        A === B
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>        A --- E
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>        A === C
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>        B === D === H
</span><span id="__span-9-13"><a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a>        B === E
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>    flowchart TD
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>        A((("Trouble Finder")))
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>        B((("Left Child")))
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a>        D[/"L Left Subtree"\]
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>        E[/"L Right Subtree"\]
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a>        H(("Trouble Maker"))
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>
</span><span id="__span-10-9"><a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>        B === D === H
</span><span id="__span-10-10"><a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a>        B --- E
</span><span id="__span-10-11"><a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a>        B === A
</span><span id="__span-10-12"><a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a>        A === E
</span><span id="__span-10-13"><a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a>        A === C
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>    flowchart TD
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>        A((("Trouble Finder")))
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>        B((("Left Child")))
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>        D[/"L Left Subtree"\]
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>        E[/"L Right Subtree"\]
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a>        H(("Trouble Maker"))
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>        B === D === H
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a>        B === A
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a>        A === E
</span><span id="__span-11-12"><a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a>        A === C
</span></code></pre></div>
</div>
</div>
</div>
<blockquote>
<p>你甚至能从整个框在<span class="heti-skip"><span class="heti-spacing"> </span>2 ~ 3<span class="heti-spacing"> </span></span>帧的变短感受到这个树的高度减少了<span><span class="heti-spacing"> </span>x</span>（逃）</p>
</blockquote>
</div>
<p>那么还有一个问题是，如何证明这样变换能够保持<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>的性质呢？</p>
<p>我个人认为主要有两个维度，一是保持二叉搜索树的性质，二是保持平衡的性质，我的证明内容折叠起来了，建议读者可以先自己思考一下再展开看看我的想法。</p>
<details class="proof">
<summary>二叉搜索树性质的保持</summary>
<p>![]<img align="right" alt="" src="assets/ch1/image.png" width="30%"/></p>
<p>不知道读者是否发现，对于一个排列得当的二叉搜索树，如果我从左到右，使用一条竖直的扫描线扫描整个树，将会得到一个单调序列，这也正对应着这个二叉搜索树所维护的有序数列。</p>
<p>基于这种论调，再回头看上面那个动态的过程，甚至是观察我在<span class="heti-skip"><span class="heti-spacing"> </span>2 ~ 3<span class="heti-spacing"> </span></span>帧画出来的这个三角形的旋转，就会发现这种旋转实际上只是在将节点上下移动，所以不改变二叉搜索树的性质。</p>
</details>
<details class="proof">
<summary>平衡的保持</summary>
<p>让我们先回顾一下在上面给出的一些性质中的第<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>条： <span class="arithmatex">\(h(\text{New L Left Subtree}) - h(\text{L Right Subtree}) = 1\)</span>。</p>
<p>在仔细思考整个旋转过程中每一个<span class="heti-skip"><span class="heti-spacing"> </span>Subtree<span class="heti-spacing"> </span></span>的高度的变化，即可得到证明。    </p>
</details>
<p>而<span class="heti-skip"><span class="heti-spacing"> </span>RR Single Rotation<span class="heti-spacing"> </span></span>完全对称，所以不再赘述。</p>
<hr/>
<h5 id="换根视角">“换根”视角</h5>
<p>现在我想尝试着用我自己的方式来理解这个问题。</p>
<p>首先让我们人力动画一下这个过程（划掉<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：</p>
<div class="admonition section">
<p class="admonition-title">LL Single Rotation</p>
<blockquote>
<p>此外，这里要素的命名都是基于<span class="heti-skip"><span class="heti-spacing"> </span>Frame 1<span class="heti-spacing"> </span></span>的，对于<span class="heti-skip"><span class="heti-spacing"> </span>Frame 4<span class="heti-spacing"> </span></span>来说<span class="heti-skip"><span class="heti-spacing"> </span>L Right Subtree<span class="heti-spacing"> </span></span>显然已经不是<span class="heti-skip"><span class="heti-spacing"> </span>L Right Subtree<span class="heti-spacing"> </span></span>了。</p>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="5:5"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio"/><input id="__tabbed_5_2" name="__tabbed_5" type="radio"/><input id="__tabbed_5_3" name="__tabbed_5" type="radio"/><input id="__tabbed_5_4" name="__tabbed_5" type="radio"/><input id="__tabbed_5_5" name="__tabbed_5" type="radio"/><div class="tabbed-labels"><label for="__tabbed_5_1">Frame 1</label><label for="__tabbed_5_2">Frame 2</label><label for="__tabbed_5_3">Frame 3</label><label for="__tabbed_5_4">Frame 4</label><label for="__tabbed_5_5">Frame 5</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>    flowchart TD
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>        A((("Trouble Finder")))
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>        B((("Left Child")))
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>        D[/"L Left Subtree"\]
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a>        H(("Trouble Maker"))
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>        E[/"L Right Subtree"\]
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a>        A === B
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a>        A === C
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a>        B === D === H
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a>        B === E
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>    flowchart TD
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>        A((("Trouble Finder")))
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>        B((("Left Child")))
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>        D[/"L Left Subtree"\]
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>        H(("Trouble Maker"))
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a>        E[/"L Right Subtree"\]
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a>        A --- B
</span><span id="__span-13-10"><a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a>        A === C
</span><span id="__span-13-11"><a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a>        B === D === H
</span><span id="__span-13-12"><a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a>        B === E
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>    flowchart TD
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>        B((("Left Child")))
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>        D[/"L Left Subtree"\]
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a>        E[/"L Right Subtree"\]
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>        H(("Trouble Maker"))
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a>        A((("Trouble Finder")))
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a>        C[/"Right Subtree"\]
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a>        A === C
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a>        B === D === H
</span><span id="__span-14-11"><a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a>        B === E
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>    flowchart TD
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>        B((("Left Child")))
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>        D[/"L Left Subtree"\]
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>        E[/"L Right Subtree"\]
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a>        H(("Trouble Maker"))
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>        A((("Trouble Finder")))
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>        C[/"Right Subtree"\]
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a>        A === C
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a>        B === D === H
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a>        A === E
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>    flowchart TD
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>        A((("Trouble Finder")))
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a>        B((("Left Child")))
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>        D[/"L Left Subtree"\]
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a>        E[/"L Right Subtree"\]
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>        H(("Trouble Maker"))
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a>        B === D === H
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a>        B === A
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a>        A === E
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a>        A === C
</span></code></pre></div>
</div>
</div>
</div>
</div>
<p>首先，我们遇到的问题是什么？是<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Maker<span class="heti-spacing"> </span></span>进来以后，<span>Trouble Finder<span class="heti-spacing"> </span></span>发现<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(h(T_l) - h(T_r) = 2\)</span><span class="heti-spacing"> </span></span>了，用通俗的话来说就是左孩子树太高了，然而在这种情况下，左孩子树依然还站在一个台子（Trouble Finder）上和<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>比身高，所以我们需要将它从台子上请下来。也就是说，既然左孩子树太高了，那么我们就不<strong>希望</strong>让它再成为谁的孩子树，因为成为谁的孩子树必然意味着这条路径会更长。</p>
<p>那么现在我们把它从台子上请下来，也就是说割裂它和<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>的亲子关系（对应<span><span class="heti-spacing"> </span>Frame 2</span>）让它们同台“对抗”（这一步在 <code>LL</code> 和 <code>RR</code> 可能显得比较多余，但是在 <code>LR</code> 和 <code>RL</code> 就会让问题清晰很多<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<p>然而我们仍然需要让这个森林重新变回一个树，所以就需要重新从里面找到根节点，显然，只能选择<span><span class="heti-spacing"> </span>Trouble Finder</span> <strong>旁边</strong> 的<span><span class="heti-spacing"> </span>Left Child</span>。但是为了继续维护二叉搜索树的性质，所以我们需要将<span class="heti-skip"><span class="heti-spacing"> </span>L Right Subtree<span class="heti-spacing"> </span></span>移植到<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>必定空缺（因为这里原先是<span><span class="heti-spacing"> </span>Left Child</span>）的左指针上。</p>
<p>OK，你可能觉得这个解释对于<span class="heti-skip"><span class="heti-spacing"> </span>LL Single Rotation<span class="heti-spacing"> </span></span>来说显得十分多此一举，但是这都是为了给后面做的铺垫，虽然这个方法看起来繁琐冗余，但是已经足以解释原先的<span class="heti-skip"><span class="heti-spacing"> </span>Single Rotation<span class="heti-spacing"> </span></span>无法解释的<span class="heti-skip"><span class="heti-spacing"> </span>LR &amp; RL<span class="heti-spacing"> </span></span>操作方法。</p>
<hr/>
<h4 id="lr--rl">LR &amp; RL</h4>
<p>首先我们需要知道为什么之前的方法不行，也是我觉得“旋转”这个做法在这个推进过程中比较割裂的地方<heti-adjacent class="heti-adjacent-half">：</heti-adjacent>（对照 <strong><a href="#旋转视角" target="_blank"><span>#<span class="heti-spacing"> </span></span>旋转视角</a></strong> 的内容阅读）我们发现，由于<span class="heti-skip"><span class="heti-spacing"> </span>LL<span class="heti-spacing"> </span></span>中的<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Maker<span class="heti-spacing"> </span></span>在左侧孩子树上，所以在旋转过程中，相当于把它“拽”上来了。然而对于<span><span class="heti-spacing"> </span>L Right Subtree</span>，无论是旋转前还是旋转后，为了维护二叉搜索树的性质，它都被接在了深度为<span class="heti-skip"><span class="heti-spacing"> </span>1<span class="heti-spacing"> </span></span>的节点上，换句话来说<span class="heti-skip"><span class="heti-spacing"> </span>L Right Subtree<span class="heti-spacing"> </span></span>贡献的高度并没有改变。对于<span class="heti-skip"><span class="heti-spacing"> </span>RL<span class="heti-spacing"> </span></span>的情况也是同理的。所以我们并不能使用<span class="heti-skip"><span class="heti-spacing"> </span>LL Single Rotation<span class="heti-spacing"> </span></span>的方法来解决这个问题。</p>
<div class="admonition note">
<p class="admonition-title">关于旋转视角</p>
<p>如果从旋转视角来考虑，确实也能考虑这个过程，但一方面过于复杂，一方面实际实现过程中也完全可以被优化，所以我希望使用换根的视角来理解这个问题。</p>
</div>
<p>那么我们换一个思路，用<strong><a href="#换根视角" target="_blank">“换根”视角</a></strong>来看待这个问题：</p>
<div class="admonition section">
<p class="admonition-title">LR Rotation</p>
<blockquote>
<p>这里两个<span class="heti-skip"><span class="heti-spacing"> </span>Subtree<span class="heti-spacing"> </span></span>接到同一个<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Maker<span class="heti-spacing"> </span></span>的意思是<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Maker<span class="heti-spacing"> </span></span>可以出现在两者任一中。</p>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="6:5"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio"/><input id="__tabbed_6_2" name="__tabbed_6" type="radio"/><input id="__tabbed_6_3" name="__tabbed_6" type="radio"/><input id="__tabbed_6_4" name="__tabbed_6" type="radio"/><input id="__tabbed_6_5" name="__tabbed_6" type="radio"/><div class="tabbed-labels"><label for="__tabbed_6_1">Frame 1</label><label for="__tabbed_6_2">Frame 2</label><label for="__tabbed_6_3">Frame 3</label><label for="__tabbed_6_4">Frame 4</label><label for="__tabbed_6_5">Frame 5</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>    flowchart TD
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>        A((("Trouble Finder")))
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>        B((("Left Child")))
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>        D(("L Left Child"))
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>        H(("Trouble Maker"))
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>        E((("L Right Child")))
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>        A === B
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a>        A === C
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>        B === D === DA
</span><span id="__span-17-15"><a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a>        B === E === EA --- H
</span><span id="__span-17-16"><a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a>        E === EB --- H
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>    flowchart TD
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>        A((("Trouble Finder")))
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>        B((("Left Child")))
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>        D(("L Left Child"))
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a>        H(("Trouble Maker"))
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>        E((("L Right Child")))
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a>        A --- B
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a>        A === C
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a>        B === D === DA
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a>        B --- E === EA --- H
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a>        E === EB --- H
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>    flowchart TD
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>        B((("Left Child")))
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>        D(("L Left Child"))
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>        H(("Trouble Maker"))
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>        E((("L Right Child")))
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a>        A((("Trouble Finder")))
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>        C[/"Right Subtree"\]
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>        A === C
</span><span id="__span-19-14"><a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a>        B === D === DA
</span><span id="__span-19-15"><a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>        E === EA --- H
</span><span id="__span-19-16"><a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a>        E === EB --- H
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a>    flowchart TD
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>        B((("Left Child")))
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a>        D(("L Left Child"))
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>        H(("Trouble Maker"))
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a>        E((("L Right Child")))
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a>        A((("Trouble Finder")))
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a>        C[/"Right Subtree"\]
</span><span id="__span-20-12"><a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a>
</span><span id="__span-20-13"><a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a>        A === C
</span><span id="__span-20-14"><a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a>        B === D === DA
</span><span id="__span-20-15"><a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a>        E --- EA --- H
</span><span id="__span-20-16"><a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a>        E --- EB --- H
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>    flowchart TD
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a>        D(("L Left Child"))
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a>        B((("Left Child")))
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a>        E((("L Right Child")))
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a>        H(("Trouble Maker"))
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a>        A((("Trouble Finder")))
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>        C[/"Right Subtree"\]
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a>        E === B
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a>        E === A
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a>        B === D === DA
</span><span id="__span-21-16"><a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a>        B === EA --- H
</span><span id="__span-21-17"><a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a>        A === EB --- H
</span><span id="__span-21-18"><a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a>        A === C
</span></code></pre></div>
</div>
</div>
</div>
</div>
<details class="extra" open="open">
<summary>关于记忆</summary>
<p>记忆这个操作如何做的话，我的记忆方法是这样的：</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:4"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio"/><input id="__tabbed_7_2" name="__tabbed_7" type="radio"/><input id="__tabbed_7_3" name="__tabbed_7" type="radio"/><input id="__tabbed_7_4" name="__tabbed_7" type="radio"/><div class="tabbed-labels"><label for="__tabbed_7_1">Frame 1</label><label for="__tabbed_7_2">Frame 2</label><label for="__tabbed_7_3">Frame 3</label><label for="__tabbed_7_4">Frame 4</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>    flowchart TD
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>        A((("Trouble Finder")))
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a>        B((("Left Child")))
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a>        D(("L Left Child"))
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a>        H(("Trouble Maker"))
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a>        E((("L Right Child")))
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-22-11"><a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a>
</span><span id="__span-22-12"><a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a>        A === B
</span><span id="__span-22-13"><a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a>        A === C
</span><span id="__span-22-14"><a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a>        B === D === DA
</span><span id="__span-22-15"><a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a>        B === E === EA --- H
</span><span id="__span-22-16"><a href="#__codelineno-22-16" id="__codelineno-22-16" name="__codelineno-22-16"></a>        E === EB --- H
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>    flowchart TD
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>        A((("Trouble Finder")))
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a>        B((("Left Child")))
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a>        C[/"Right Subtree"\]
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a>        D(("L Left Child"))
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a>        H(("Trouble Maker"))
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>        E((("L Right Child")))
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a>        A --- B
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>        A --- E
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a>        A === C
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>        B === D === DA
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a>        B --- E === EA --- H
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a>        E === EB --- H
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>    flowchart TD
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>        A((("Trouble Finder")))
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>        B((("Left Child")))
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a>        D(("L Left Child"))
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a>        H(("Trouble Maker"))
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a>        E((("L Right Child")))
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a>        C[/"Right Subtree"\]
</span><span id="__span-24-11"><a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a>
</span><span id="__span-24-12"><a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a>        A --- B
</span><span id="__span-24-13"><a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a>        E --- B 
</span><span id="__span-24-14"><a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a>        E --- A
</span><span id="__span-24-15"><a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a>        B === D === DA
</span><span id="__span-24-16"><a href="#__codelineno-24-16" id="__codelineno-24-16" name="__codelineno-24-16"></a>        B --- EA --- H
</span><span id="__span-24-17"><a href="#__codelineno-24-17" id="__codelineno-24-17" name="__codelineno-24-17"></a>        A --- EB --- H
</span><span id="__span-24-18"><a href="#__codelineno-24-18" id="__codelineno-24-18" name="__codelineno-24-18"></a>        A === C
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a>    flowchart TD
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>        A((("Trouble Finder")))
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>        B((("Left Child")))
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a>        D(("L Left Child"))
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a>        DA[/"L Left Subtree"\]
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a>        H(("Trouble Maker"))
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a>        E((("L Right Child")))
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a>        EA[/"L Left Subtree"\]
</span><span id="__span-25-9"><a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a>        EB[/"L Right Subtree"\]
</span><span id="__span-25-10"><a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a>        C[/"Right Subtree"\]
</span><span id="__span-25-11"><a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a>
</span><span id="__span-25-12"><a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a>        E --- B 
</span><span id="__span-25-13"><a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a>        E --- A
</span><span id="__span-25-14"><a href="#__codelineno-25-14" id="__codelineno-25-14" name="__codelineno-25-14"></a>        B === D === DA
</span><span id="__span-25-15"><a href="#__codelineno-25-15" id="__codelineno-25-15" name="__codelineno-25-15"></a>        B --- EA --- H
</span><span id="__span-25-16"><a href="#__codelineno-25-16" id="__codelineno-25-16" name="__codelineno-25-16"></a>        A --- EB --- H
</span><span id="__span-25-17"><a href="#__codelineno-25-17" id="__codelineno-25-17" name="__codelineno-25-17"></a>        A === C
</span></code></pre></div>
</div>
</div>
</div>
<p>用语言概括就是，找到关键的那三个点，然后把最下面的顶到上面去，剩下两个作为左右孩子树，原先的那个点的左右孩子树则对应地，左孩子树接到左边空缺的右孩子树上，右孩子树接到右边空缺的左孩子树上。</p>
</details>
<div class="admonition question">
<p class="admonition-title">如果一个<span class="heti-skip"><span class="heti-spacing"> </span>Trouble<span class="heti-spacing"> </span></span>产生后，出现了多个<span><span class="heti-spacing"> </span>Trouble Finder</span>，该如何处理？</p>
<p>首先，请回顾一下 <strong><a href="#操作" target="_blank"><span>#<span class="heti-spacing"> </span></span>操作</a></strong> 中被加粗的这一句话<heti-adjacent class="heti-adjacent-half">，</heti-adjacent>「以『距离案发现场最近的<span><span class="heti-spacing"> </span>Trouble Finder</span>』为根的孩子树<heti-adjacent class="heti-adjacent-half">」</heti-adjacent>。也就是说，我们现在已经有了解决最近的<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>的方案。</p>
<p>感性的思考，<span>AVL<span class="heti-spacing"> </span></span>的“平衡”可以由递归形式定义，具体来说衡量的是左右孩子树的“高度”差。当我们解决了一个<span><span class="heti-spacing"> </span>Trouble Finder</span>，意味着我们让<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>的最高的那个孩子树高度<span><span class="heti-spacing"> </span>-1</span>，这也意味着以<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>为根的那个孩子树高度<span><span class="heti-spacing"> </span>-1</span>，这也意味着其所有父节点的平衡因子都会相应地变化。</p>
<p>一个<span class="heti-skip"><span class="heti-spacing"> </span>Trouble<span class="heti-spacing"> </span></span>当且仅有一个<span><span class="heti-spacing"> </span>Trouble Maker</span>，而且它必定是<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>所关注的那个“最长路径”的端点，这也意味着所有的子<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>都在对应的父<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>的“最长路径”上。而现在我们让子<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Finder<span class="heti-spacing"> </span></span>唯一（如果不唯一，那在这个<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Maker<span class="heti-spacing"> </span></span>到来之前就已经存在<span class="heti-skip"><span class="heti-spacing"> </span>Trouble<span class="heti-spacing"> </span></span>了）的最长路径也应当会<span><span class="heti-spacing"> </span>-1</span>。而这必将导致其平衡因子的绝对值<span><span class="heti-spacing"> </span>-1</span>。</p>
</div>
<h3 id="avl-树的删除"><span>*AVL<span class="heti-spacing"> </span></span>树的删除</h3>
<div class="admonition note">
<p class="admonition-title">更规范的对<span class="heti-skip"><span class="heti-spacing"> </span>"<span class="heti-spacing"> </span></span>失衡<span class="heti-skip"><span class="heti-spacing"> </span>"<span class="heti-spacing"> </span></span>的定义</p>
<p><img alt="" src="assets/ch1/image-4.png"/></p>
<p>删除与插入不同，维护了最近的失衡点后可能并能维护更上面的失衡点，所以我们需要从被删除节点开始沿着路径向上递归地维护</p>
<p>这也是为什么<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树与<span class="heti-skip"><span class="heti-spacing"> </span>RB<span class="heti-spacing"> </span></span>树中只有<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>的删除操作会带来<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(O(logn)\)</span><span class="heti-spacing"> </span></span>的旋转操作（详见<span class="heti-skip"><span class="heti-spacing"> </span>ch2<span class="heti-spacing"> </span></span>总结部分）</p>
</div>
<p>可以参照该视频做巩固复习<span class="heti-skip"><span class="heti-spacing"> </span>(<span class="heti-spacing"> </span></span><a href="https://www.bilibili.com/video/BV1tZ421q72h?t=736">平衡二叉树<span class="heti-skip"><span class="heti-spacing"> </span>(AVL<span class="heti-spacing"> </span></span>树<span class="heti-skip"><span class="heti-spacing"> </span>)<span class="heti-spacing"> </span></span>的删除</a><span><span class="heti-spacing"> </span>)</span></p>
<hr/>
<h2 id="splay-树"><span>Splay<span class="heti-spacing"> </span></span>树</h2>
<div class="admonition quote">
<p class="admonition-title">link</p>
<p>OI Wiki: <a href="https://oi-wiki.org/ds/splay/">https://oi-wiki.org/ds/splay/</a></p>
</div>
<p><span>Splay<span class="heti-spacing"> </span></span>树，即伸展树，想要解决的问题和<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树类似，只不过<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>树希望达到的目标是在<strong>摊还<span><span class="heti-spacing"> </span>(Amortized)</span></strong>复杂度<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(O(\log N)\)</span><span class="heti-spacing"> </span></span>的情况下完成大部分对点操作。</p>
<p>我们知道，为使<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>保持平衡，我们需要维护从根节点到<span class="heti-skip"><span class="heti-spacing"> </span>Trouble Maker<span class="heti-spacing"> </span></span>这条路径上所有点的平衡因子。而<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>则不再维护这些信息，这意味着我们无法保证<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>树的状态都是平衡的，但是我们希望它尽可能平衡。具体来说就是对于<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(M\)</span><span class="heti-spacing"> </span></span>次任意操作，其时间复杂度都为<span><span class="heti-spacing"> </span><span class="arithmatex">\(O(M\log N)\)</span></span>，均摊下来这<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(M\)</span><span class="heti-spacing"> </span></span>个操作每一个都需要<span><span class="heti-spacing"> </span><span class="arithmatex">\(O(\log N)\)</span></span>。</p>
<p>对于一个树，我们对其节点进行的操作可能是：<strong>增</strong>点、<strong>删</strong>点、<strong>改</strong>点、<strong>查</strong>点等等，而不同类型的操作开销可能不尽相同。简单的计算其平均值则忽略了这些操作之间互相的影响或者是操作频率的问题，所以我们这里使用<strong>摊还</strong>复杂度来描述其效率。</p>
<blockquote>
<p>关于摊还的问题我们还会在之后进一步深入。</p>
</blockquote>
<p>那么说了这么多，<span>Splay<span class="heti-spacing"> </span></span>是怎么实现这一目标的呢？</p>
<p><span>Splay<span class="heti-spacing"> </span></span>的核心思想就是，每当我们访问一个节点（比如查询某个点、插入某个点，甚至是删除某个点<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，我们就通过一系列操作将目标点转移到根部，形象上理解就是不断旋转整个树的构造，知道把点转到根部。</p>
<div class="admonition eg">
<p>例如我们查询点<span><span class="heti-spacing"> </span><span class="arithmatex">\(k_1\)</span></span>，则会通过旋转将它转到根。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:3"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio"/><input id="__tabbed_8_2" name="__tabbed_8" type="radio"/><input id="__tabbed_8_3" name="__tabbed_8" type="radio"/><div class="tabbed-labels"><label for="__tabbed_8_1">Frame 1</label><label for="__tabbed_8_2">Frame 2</label><label for="__tabbed_8_3">Frame 3</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><img alt="" src="assets/ch1/image-1.png"/></p>
</div>
<div class="tabbed-block">
<p><img alt="" src="assets/ch1/image-2.png"/></p>
</div>
<div class="tabbed-block">
<p><img alt="" src="assets/ch1/image-3.png"/></p>
</div>
</div>
</div>
<p>可以发现，<span>Frame 1 ~ 2<span class="heti-spacing"> </span></span>就是我们前面提到过的 <strong><a href="#lr--rl" target="_blank">LR Rotation</a></strong>，而<span class="heti-skip"><span class="heti-spacing"> </span>Frame 2 ~ 3<span class="heti-spacing"> </span></span>就是经过了两次 <strong><a href="#ll--rr" target="_blank">LL Rotation</a></strong>。当然，在<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>里这些操作都有了新的名字。</p>
</div>
<p>这个例子只是为了给读者一个初始印象，之后我们将更详细、准确的介绍操作。</p>
<blockquote>
<p>（没玩过可能听不太懂）不知道大家有没有玩过那种电子游戏，就是有好多转盘，相邻转盘之间有交界处，这些交界点上都会有圆球，当一个转盘旋转的时候，其圆周上的球体都会跟着这个圆周转动。通过不停转动相邻的圆盘，我们可以实现把某个位置的圆球转移到另外一个位置。而<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>差不多是这么个感觉。</p>
</blockquote>
<hr/>
<h3 id="基本操作">基本操作</h3>
<p>首先我们做一个约定，对于任意一个节点<span><span class="heti-spacing"> </span>X</span>，我们记其父节点为<span><span class="heti-spacing"> </span>P(Parent)</span>，其父节点的父节点为<span><span class="heti-spacing"> </span>G(Grandparent)</span>。</p>
<ul>
<li>当我们访问到某个点<span class="heti-skip"><span class="heti-spacing"> </span>X<span class="heti-spacing"> </span></span>时：<ul>
<li>如果<span class="heti-skip"><span class="heti-spacing"> </span>P<span class="heti-spacing"> </span></span>是根节点，则直接进行一次<a href="#ll--rr" target="_blank"><span><span class="heti-spacing"> </span>Single Rotation</span></a>，将<span class="heti-skip"><span class="heti-spacing"> </span>X<span class="heti-spacing"> </span></span>转到根节点；</li>
<li>如果<span class="heti-skip"><span class="heti-spacing"> </span>P<span class="heti-spacing"> </span></span>不是根节点：<ul>
<li>当情况为<span class="heti-skip"><span class="heti-spacing"> </span>LR / RL<span class="heti-spacing"> </span></span>时，进行一次<a href="#lr--rl" target="_blank"><span class="heti-skip"><span class="heti-spacing"> </span>LR Rotation<span class="heti-spacing"> </span></span>或<span><span class="heti-spacing"> </span>RL Rotation</span></a>，我们称之为<span><span class="heti-spacing"> </span>zig-zag</span>；</li>
<li>当情况为<span class="heti-skip"><span class="heti-spacing"> </span>LL / RR<span class="heti-spacing"> </span></span>时，进行两次<a href="#ll--rr" target="_blank"><span><span class="heti-spacing"> </span>Single Rotation</span></a>，使得<span><span class="heti-spacing"> </span>X</span>、P、<span>G<span class="heti-spacing"> </span></span>的顺序逆转，像跷跷板一样，我们称之为<span><span class="heti-spacing"> </span>zig-zig</span>；</li>
</ul>
</li>
<li>不断对<span class="heti-skip"><span class="heti-spacing"> </span>X<span class="heti-spacing"> </span></span>进行<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>操作，直到<span class="heti-skip"><span class="heti-spacing"> </span>X<span class="heti-spacing"> </span></span>成为根节点；</li>
</ul>
</li>
</ul>
<p><img alt="" src="assets/ch1/image-5.png"/></p>
<p>可以发现，其具体操作基本就和<span class="heti-skip"><span class="heti-spacing"> </span>AVL<span class="heti-spacing"> </span></span>树的相关操作有很大重合。</p>
<div class="admonition property">
<p class="admonition-title">效果</p>
<p>Splaying not only moves the accessed node to the root, but also roughly halves the depth of most nodes on the path.</p>
</div>
<hr/>
<h3 id="对点操作">对点操作</h3>
<p>由于<span class="heti-skip"><span class="heti-spacing"> </span>Splay Tree<span class="heti-spacing"> </span></span>除了在完成所有操作以后都需要进行一次<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>操作，其他部分都和<span class="heti-skip"><span class="heti-spacing"> </span>BST<span class="heti-spacing"> </span></span>一样，所以这里只简单介绍一下<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>的部分。</p>
<div class="admonition section">
<p class="admonition-title">Find X</p>
<p>根据<span class="heti-skip"><span class="heti-spacing"> </span>BST<span class="heti-spacing"> </span></span>的性质，可以在<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(O(\log N)\)</span><span class="heti-spacing"> </span></span>的时间里找到<span><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span></span>，接下来通过旋转操作，将<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>不断旋转至根，最终直接取出<span class="heti-skip"><span class="heti-spacing"> </span>Root<span class="heti-spacing"> </span></span>即为结果。   </p>
</div>
<div class="admonition section">
<p class="admonition-title">Remove X</p>
<ul>
<li>根据<span class="heti-skip"><span class="heti-spacing"> </span>BST<span class="heti-spacing"> </span></span>的性质，可以在<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(O(\log N)\)</span><span class="heti-spacing"> </span></span>的时间里找到<span><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span></span></li>
<li>接下来通过旋转操作，将<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>不断旋转至根</li>
<li>接下来删除<span class="heti-skip"><span class="heti-spacing"> </span>Root<span class="heti-spacing"> </span></span>节点。这样就得到了两个子树<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T_L\)</span><span class="heti-spacing"> </span></span>和<span><span class="heti-spacing"> </span><span class="arithmatex">\(T_R\)</span></span></li>
<li>以<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(T_L\)</span><span class="heti-spacing"> </span></span>为例，<span class="arithmatex">\(FindMax(T_L)\)</span>,The largest element will be the root of <span class="arithmatex">\(T_L\)</span>, and has no right child.</li>
<li>Make <span class="arithmatex">\(T_R\)</span> the right child of the root of <span class="arithmatex">\(T_L\)</span></li>
</ul>
</div>
<div class="admonition section">
<p class="admonition-title">Find Max</p>
<p>根据<span class="heti-skip"><span class="heti-spacing"> </span>BST<span class="heti-spacing"> </span></span>的性质，可以在<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(O(\log N)\)</span><span class="heti-spacing"> </span></span>的时间里找到最大值，将它旋转到根部以后，可以发现它没有右孩子树，直接删掉就行。</p>
</div>
<hr/>
<h3 id="摊还分析">摊还分析</h3>
<div class="admonition advice">
<p class="admonition-title">前置阅读</p>
<p>关于摊还分析的基本知识，请查看 <strong><a href="ch0.html#摊还分析">Topic 1 | Amortized Analysis</a></strong>。</p>
</div>
<p>此处，我们将使用<strong>势能法</strong>来分析<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>的摊还复杂度，由于课件省略了很多细节上的解释，所以我这里会补充非常多内容。</p>
<p>开始分析之前，我们首先需要明确分析的目标：</p>
<p>对于<span><span class="heti-spacing"> </span>Splay</span>，它不像我们在摊还分析中提到的那些案例一样，存在明显的减势和增势行为。对于<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>来说，所有我们提到的操作都依赖于将目标点旋转到根来实现，而这也成为其主要开销（部分常数操作显然被覆盖，插入之类的操作之所以能被忽略的原因，可以参考<span class="heti-skip"><span class="heti-spacing"> </span>ltgg<span class="heti-spacing"> </span></span>的<strong><a href="https://www.yuque.com/27rabbit/gi2sf3/veonae">这篇文章</a></strong><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。其中我们会用到若干次 <code>zig</code>、<code>zig-zag</code>、<code>zig-zig</code> 的操作。</p>
<p>因此我们可以认为，我们要分析的目标为：</p>
<div class="arithmatex">\[
T_{\text{rotate }x\text{ to root}} = T_{\text{zig}} + \sum{ {T_{\text{zig-zag}}}_i } + \sum{ {T_{\text{zig-zig}}}_i }
\]</div>
<blockquote>
<p>上面三个部分每一个都有可能是<span><span class="heti-spacing"> </span><span class="arithmatex">\(0\)</span></span>，而 <code>zig</code> 最多只会发生一次！</p>
</blockquote>
<p>接下来，我们需要设计一个势能函数<span><span class="heti-spacing"> </span><span class="arithmatex">\(\Phi(x)\)</span></span>，并且根据我们提到过的势能分析法的特性，<span><span class="arithmatex">\(\Phi(x)\)</span><span class="heti-spacing"> </span></span>应该具有这么几个特征：</p>
<ul>
<li>开销大的操作应当倾向让势能降，开销小的操作应当倾向让势能升；</li>
<li>势能高倾向于让某些操作开销大，势能低倾向于让某些操作开销小；</li>
<li><span class="arithmatex">\(\Phi(final) &gt; \Phi(initial)\)</span>；</li>
</ul>
<p>于是这里我们设计的势能函数为：</p>
<div class="arithmatex">\[
\Phi(T) = \sum_{des \in T} \log Size(des) = \sum_{des \in T} Rank(des)\\
\begin{aligned}
    &amp;\text{Where } des \text{ means the descendant of } T \text{,}\\
    &amp;\text{and } Size(des) \text{ means the number of the nodes of } des \text{.} \\
    &amp;\text{And we note } Rank(des) = \log Size(des) \approx Height(des) \text{.}
\end{aligned}
\]</div>
<p>用语言描述一下就是，对于某个孩子树<span><span class="heti-spacing"> </span><span class="arithmatex">\(T\)</span></span>，其势能函数<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(\Phi(T)\)</span><span class="heti-spacing"> </span></span>等于<u>以所有它的后代为根</u>的孩子树的大小取对数以后求和。</p>
<div class="admonition warning">
<p class="admonition-title">Rank v.s. Height</p>
<p>这里需要注意的一个点是，虽然<span><span class="heti-spacing"> </span><span class="arithmatex">\(Rank(des) \approx Height(des)\)</span></span>，但是我们不应该用<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(Height()\)</span><span class="heti-spacing"> </span></span>来代替<span><span class="heti-spacing"> </span><span class="arithmatex">\(Rank()\)</span></span>，主要原因是在旋转过程中，<span><span class="arithmatex">\(Rank()\)</span><span class="heti-spacing"> </span></span>不会变化（因为<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(Size()\)</span><span class="heti-spacing"> </span></span>不会变化<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，但是<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(Height()\)</span><span class="heti-spacing"> </span></span>可能变化。换句话来说，如果选用<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(Height()\)</span><span class="heti-spacing"> </span></span>作为势能函数，我们就不得已考虑整棵树，而非只需要考虑当前旋转涉及的孩子树。</p>
</div>
<p>关于正确性的说明，我会放在之后的过程中一个个插入，它们会被包裹在 <code>key-point</code> 文字框中，请注意这些内容。接下来我们就可以开始分析了，根据我们给定的目标：</p>
<div class="arithmatex">\[
T_{\text{rotate }x\text{ to root}} = T_{\text{zig}} + \sum{ {T_{\text{zig-zag}}}_i } + \sum{ {T_{\text{zig-zig}}}_i }
\]</div>
<p>我们利用均摊分析，需要得到一个平滑上界：</p>
<div class="arithmatex">\[
\hat{c}_{\text{rotate }x\text{ to root}} = \hat{c}_{\text{zig}} + \sum{ {\hat{c}_{\text{zig-zag}}}_i } + \sum{ {\hat{c}_{\text{zig-zig}}}_i }
\]</div>
<p>而我们需要证明<span><span class="heti-spacing"> </span><span class="arithmatex">\(\hat{c}_{\text{rotate }x\text{ to root}} = O(\log{N})\)</span></span>，现在我们需要分别分析 <code>zig</code>、<code>zig-zag</code>、<code>zig-zig</code>。</p>
<hr/>
<h4 id="zig">zig</h4>
<div class="admonition section">
<p class="admonition-title">Amortized Analysis for Zig</p>
<p><img alt="" src="assets/ch1/image-6.png"/></p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig}}}_i
    &amp;= {c_{\text{zig}}}_i + \Phi_{i}(X) - \Phi_{i-1}(P) \\
    &amp;= 1 + Rank_{i}(X) - Rank_{i-1}(X) +  Rank_{i}(P) - Rank_{i-1}(P)
\end{aligned}
\]</div>
<p>观察配图，<span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>多了<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(P\)</span><span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(C\)</span><span class="heti-spacing"> </span></span>作为子嗣，而<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(P\)</span><span class="heti-spacing"> </span></span>悲惨地失去了<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>一族，甚至成了<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>的后代，即<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>盛<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(P\)</span><span class="heti-spacing"> </span></span>衰，因此就有不等式：</p>
<div class="arithmatex">\[
\left\{
    \begin{aligned}
        &amp; Rank_{i}(X) - Rank_{i-1}(X) \geq 0\\
        &amp; Rank_{i}(P) - Rank_{i-1}(P) \leq 0
    \end{aligned}    
\right.
\]</div>
<p>所以我们可以做简单的缩放：</p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig}}}_i
    &amp;= 1 + \underbrace{Rank_{i}(X) - Rank_{i-1}(X)}_{\geq 0} + \underbrace{Rank_{i}(P) - Rank_{i-1}(P)}_{\leq 0} \\
    &amp;\leq 1 + Rank_{i}(X) - Rank_{i-1}(X)
\end{aligned}
\]</div>
</div>
<div class="admonition key-point">
<p class="admonition-title">为什么不是另外一种选择<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>为何这样缩放？</p>
<blockquote>
<p>这一部分在<span class="heti-skip"><span class="heti-spacing"> </span>cy<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>PPT<span class="heti-spacing"> </span></span>里并没有详细说明，但是我认为这是这个分析方法成立一个非常重要的因素！</p>
</blockquote>
<p>也许你已经注意到了，又或者你了解了之后两种分析，又回过头来思考发现，这里其实存在另外一种更紧凑的缩放方法（甚至不能说“缩放”<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，观察到<span><span class="heti-spacing"> </span><span class="arithmatex">\(Size_{i}(X) =Size_{i-1}(P)\)</span></span>，所以：</p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig}}}_i
    &amp;= 1 + Rank_{i}(P) - Rank_{i-1}(X) + \underbrace{Rank_{i}(X) - Rank_{i-1}(P)}_{= 0} \\
    &amp;= 1 + Rank_{i}(P) - Rank_{i-1}(X)
\end{aligned}
\]</div>
<p>但是这不便于我们之后的传递。还记得我们要求的目标吗？</p>
<div class="arithmatex">\[
\hat{c}_{\text{rotate }x\text{ to root}} = \hat{c}_{\text{zig}} + \sum{ {\hat{c}_{\text{zig-zag}}}_i } + \sum{ {\hat{c}_{\text{zig-zig}}}_i }
\]</div>
<p>我们之后需要对各种<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(\hat{c}\)</span><span class="heti-spacing"> </span></span>进行求和，而每一次的<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(X,\;P,\;G\)</span><span class="heti-spacing"> </span></span>都是不同的，为了在求和的时候实现错位相减，我们必须保证缩放得到的结果具有一定的<strong>传递性质</strong>，或者说在求和过程中能够达到<strong>裂项相消</strong>的效果。</p>
<p>而对于<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>来说，我们的操作传递，正是通过不断将我们关注的<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>点<strong>递归地向上旋转</strong>实现的。换句话来说，<span><span class="arithmatex">\(\Phi_{i}(X)\)</span><span class="heti-spacing"> </span></span>中的<span><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span></span>，就是<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(\Phi_{i-1}(X)\)</span><span class="heti-spacing"> </span></span>中的<span><span class="heti-spacing"> </span><span class="arithmatex">\(X\)</span></span>，如此我们最终可以得到<span><span class="heti-spacing"> </span><span class="arithmatex">\(\Phi_{n}(X) - \Phi_{0}(X)\)</span></span>，而其中一个是根，一个是我们一开始打算操作的那个点。</p>
<p>于是我们理想的缩放目标就是<span><span class="heti-spacing"> </span><span class="arithmatex">\(k(Rank_{i}(X) - Rank_{i-1}(X)) \;\; \text{where } k \text{ is fixed for all the terms}\)</span></span>。</p>
<hr/>
<blockquote>
<p>不过你可能又要提问了，<code>zig</code> 分析的结果里不是有个<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\({c_{\text{zig}}}_i = 1\)</span><span class="heti-spacing"> </span></span>吗？</p>
<p>这是因为 <code>zig</code> 最多只发生一次，所以这个常数是没有影响的。</p>
</blockquote>
</div>
<div class="admonition key-point">
<p class="admonition-title">真的需要都缩放到相同的<span class="heti-skip"><span class="heti-spacing"> </span>k<span class="heti-spacing"> </span></span>吗</p>
<p>随之而来的，一个需要讨论的问题是「<span class="arithmatex">\(\text{where } k \text{ is fixed for all the terms}\)</span>」真的重要吗，换句话来说，我们必须保证三个部分缩放出来都具有相同的<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(k\)</span><span class="heti-spacing"> </span></span>吗？</p>
<p>首先，重要肯定是重要的，只不过在这个问题中，由于我们旋转的方向都是向上，所以<span><span class="heti-spacing"> </span><span class="arithmatex">\(Rank_{i}(X) \geq Rank_{i-1}(X)\)</span></span>，因此我们只需要最后将它们一起都缩放到<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(k_{overall} = \max\{k_\text{zig}, k_\text{zig-zag}, k_\text{zig-zig} \}\)</span><span class="heti-spacing"> </span></span>就可以了。</p>
</div>
<hr/>
<h4 id="zig-zag">zig-zag</h4>
<div class="admonition section">
<p class="admonition-title">Amortized Analysis for Zig-Zag</p>
<p><img alt="" src="assets/ch1/image-7.png"/></p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig-zag}}}_i 
    &amp;= {c_{\text{zig-zag}}}_i + \Phi_{i}(X)- \Phi_{i-1}(G) \\
    &amp;= 2 + Rank_{i}(X) - Rank_{i-1}(X) + Rank_{i}(P) - Rank_{i-1}(P) + Rank_{i}(G) - Rank_{i-1}(G)
\end{aligned}
\]</div>
<p>观察配图，<span><span class="arithmatex">\(X\)</span><span class="heti-spacing"> </span></span>又一次绝地反击，成为它家长和它家长的家长共同的家长；<span><span class="arithmatex">\(G\)</span><span class="heti-spacing"> </span></span>损失最惨重，丢掉了<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(A,\;B\)</span><span class="heti-spacing"> </span></span>两族子嗣。</p>
<p>在这次的缩放中，根据我们之前在 <code>key-point</code> 里提到的，我们需要将它缩放到<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(k(Rank_{i}(X) - Rank_{i-1}(X))\)</span><span class="heti-spacing"> </span></span>的形式，并且由于 <code>zig-zig</code> 会多次发生，所以我们也得想办法搞掉这里的<span><span class="heti-spacing"> </span><span class="arithmatex">\({c_{\text{zig-zag}}}_i = 2\)</span></span>，否则最后就会出现一个<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(2p(n)\)</span><span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>term</span>，而我们的证明目标是<span><span class="heti-spacing"> </span><span class="arithmatex">\(\log{N}\)</span></span>，所以我们必须将这个<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(2\)</span><span class="heti-spacing"> </span></span>消掉。而为了消除这个<span><span class="heti-spacing"> </span><span class="arithmatex">\(2\)</span></span>，我们需要先引入一个引理：</p>
<div class="admonition property">
<p class="admonition-title">Lemma 1</p>
<p>由于<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(y = \log{x}\)</span><span class="heti-spacing"> </span></span>是单调的凸函数，所以有<span><span class="heti-spacing"> </span><span class="arithmatex">\(\frac{\log{x} + \log{b}}{2} \leq \log {\frac{a+b}{2}}\)</span></span>。</p>
<p>而在<span class="heti-skip"><span class="heti-spacing"> </span>Splay<span class="heti-spacing"> </span></span>的均摊复杂度分析过程中，我们的<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(\log{x}\)</span><span class="heti-spacing"> </span></span>指的是<span><span class="heti-spacing"> </span><span class="arithmatex">\(\log_2{x}\)</span></span>，因此有：</p>
<div class="arithmatex">\[
\begin{aligned}
    \log{a} + \log{b} 
    &amp;= 2\left( \frac{\log{a} + \log{b}}{2} \right) \\
    &amp;\leq 2\left( \log{\frac{a+b}{2}} \right) \\
    &amp;= 2\left( \log{(a+b)} - \log{2} \right) \\
    &amp;= 2 \log{(a+b)} - 2 \\
\end{aligned}
\]</div>
</div>
<p>看到这里出现了一个<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(-2\)</span><span class="heti-spacing"> </span></span>我们就能长舒一口气了，这下<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\({c_{\text{zig-zag}}}_i = 2\)</span><span class="heti-spacing"> </span></span>死到临头咯！对照配图看，我们可以得到：</p>
<div class="arithmatex">\[
\begin{aligned}
    Rank_{i}(P) + Rank_{i}(G)   &amp;= \log{Size_{i}(P)} + \log{Size_{i}(G)} \\
                                &amp;\leq 2\log{\left(Size_{i}(P)+Size_{i}(G)\right)} - 2 &amp; \text{(Lemma 1)}\\
                                &amp;\leq 2\log{\left(Size_{i}(P)+Size_{i}(G)+1\right)} - 2 \\
                                &amp;\leq 2\log{Size_{i}(X)} - 2 \\
                                &amp;\leq 2Rank_{i}(X) - 2 \\
\end{aligned}
\]</div>
<p>因此，我们能够得到这些相等或不等关系：</p>
<div class="arithmatex">\[
\left\{
    \begin{aligned}
        Rank_{i}(X) &amp;= Rank_{i-1}(G) \\
        Rank_{i}(P) + Rank_{i}(G) &amp;\leq 2Rank_{i}(X) - 2 \\
        Rank_{i-1}(P) + Rank_{i-1}(X) &amp;\geq 2Rank_{i-1}(X)
    \end{aligned}
\right.
\]</div>
<p>于是我们可以实现缩放：</p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig-zag}}}_i 
    &amp;= 2 + Rank_{i}(X) - Rank_{i-1}(X) + Rank_{i}(P) - Rank_{i-1}(P) + Rank_{i}(G) - Rank_{i-1}(G) \\
    &amp;= 2 + \left( Rank_{i}(X) - Rank_{i-1}(G)\right ) 
         + \left( Rank_{i}(P) + Rank_{i}(G) \right)
         - \left( Rank_{i-1}(P) + Rank_{i-1}(X) \right) \\
    &amp;\leq 2 + 0 + 2Rank_{i}(X) - 2 + 2Rank_{i-1}(X) \\
    &amp;= 2\left(Rank_{i}(X) - Rank_{i-1}(X)\right)
\end{aligned}
\]</div>
<p>皆大欢喜！</p>
</div>
<hr/>
<h4 id="zig-zig">zig-zig</h4>
<div class="admonition section">
<p class="admonition-title">Amortized Analysis for Zig-Zig</p>
<p><img alt="" src="assets/ch1/image-8.png"/></p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig-zig}}}_i 
    &amp;= {c_{\text{zig-zig}}}_i + \Phi_{i}(X)- \Phi_{i-1}(G) \\
    &amp;= 2 + Rank_{i}(X) - Rank_{i-1}(X) + Rank_{i}(P) - Rank_{i-1}(P) + Rank_{i}(G) - Rank_{i-1}(G)
\end{aligned}
\]</div>
<p>为了实现 <code>zig-zig</code> 的缩放，我们还需要对<span class="heti-skip"><span class="heti-spacing"> </span>Lemma 1<span class="heti-spacing"> </span></span>进行一个活用。对照配图，得到：</p>
<div class="arithmatex">\[
\begin{aligned}
    Rank_{i}(G) + Rank_{i-1}(X) 
        &amp;\leq 2\log{\left( 
            \underbrace{Size_{i}(G)}_{\mathbf{C}+\mathbf{D}+G}
          + \underbrace{Size_{i-1}(X)}_{\mathbf{A}+\mathbf{B}+X}
        \right)} - 2 &amp; \text{(Lemma 1)} \\
        &amp;\leq 2\log{\left( Size_{i}(G) + Size_{i-1}(X) + 1 \right)} - 2 &amp; \\
        &amp;= 2\log{\left( Size_{i}(X) \right)} - 2 \\
        &amp;= 2Rank_{i}(X) - 2 \\
    Rank_{i}(G) 
        &amp;\leq 2Rank_{i}(X) - Rank_{i-1}(X) - 2
\end{aligned}
\]</div>
<blockquote>
<p>这一步很难想，但是也非常关键。</p>
</blockquote>
<p>于是，我们有如下这些不等式：</p>
<div class="arithmatex">\[
\left\{
    \begin{aligned}
        Rank_{i}(X) &amp;= Rank_{i-1}(G) \\
        Rank_{i}(G) &amp;\leq 2Rank_{i}(X) - Rank_{i-1}(X) - 2 \\
        Rank_{i}(P) &amp;\leq Rank_{i}(X) \\
        Rank_{i-1}(P) &amp;\geq Rank_{i-1}(X)
    \end{aligned}
\right.
\]</div>
<p>于是我们就可以对其进行<s>诡异</s>的缩放：</p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig-zig}}}_i 
    &amp;= 2 + Rank_{i}(X) - Rank_{i-1}(X) + Rank_{i}(P) - Rank_{i-1}(P) + Rank_{i}(G) - Rank_{i-1}(G) \\
    &amp;= 2 + \left( Rank_{i}(X) - Rank_{i-1}(G) \right)
         + Rank_{i}(G)
         + Rank_{i}(P)
         - Rank_{i-1}(P)
         - Rank_{i-1}(X) \\
    &amp;\leq 2 + 0 
            + \left( 2Rank_{i}(X) - Rank_{i-1}(X) - 2 \right) 
            + Rank_{i}(X)
            - Rank_{i-1}(X)
            - Rank_{i-1}(X) \\
    &amp;= 3\left( Rank_{i}(X) - Rank_{i-1}(X) \right)
\end{aligned}
\]</div>
<p>😩 至此，我们总算是把牛鬼蛇神的 <code>zig-zig</code> 的证明也给搞定了。</p>
</div>
<hr/>
<h4 id="结论">结论</h4>
<div class="admonition section">
<p class="admonition-title">Amortized Analysis for Splay</p>
<p>至此，对于三种操作，我们都得到了它们的均摊上界：</p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig}}}_i &amp;\leq 1 + Rank_{i}(X) - Rank_{i-1}(X) \\
    {\hat{c}_{\text{zig-zag}}}_i &amp;\leq 2\left(Rank_{i}(X) - Rank_{i-1}(X)\right) \\
    {\hat{c}_{\text{zig-zig}}}_i &amp;\leq 3\left(Rank_{i}(X) - Rank_{i-1}(X)\right)
\end{aligned}
\]</div>
<p>根据我们在 <code>key-point</code> 框「真的需要都缩放到相同的<span class="heti-skip"><span class="heti-spacing"> </span>k<span class="heti-spacing"> </span></span>吗」中的内容，我们接下来可以将它们的<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(k\)</span><span class="heti-spacing"> </span></span>都缩放为<span><span class="heti-spacing"> </span><span class="arithmatex">\(3\)</span></span>：</p>
<div class="arithmatex">\[
\begin{aligned}
    {\hat{c}_{\text{zig}}}_i &amp;\leq 1 + 3\left( Rank_{i}(X) - Rank_{i-1}(X) \right) \\
    {\hat{c}_{\text{zig-zag}}}_i &amp;\leq 3\left( Rank_{i}(X) - Rank_{i-1}(X) \right) \\
    {\hat{c}_{\text{zig-zig}}}_i &amp;\leq 3\left( Rank_{i}(X) - Rank_{i-1}(X) \right)
\end{aligned}
\]</div>
<p>于是，我们就可以得到最终的均摊上界：</p>
<div class="arithmatex">\[
\begin{aligned}
    \hat{c}_{\text{rotate }x\text{ to root}} 
        &amp;= \hat{c}_{\text{zig}} + \sum{ {\hat{c}_{\text{zig-zag}}}_i } + \sum{ {\hat{c}_{\text{zig-zig}}}_i } \\
        &amp;= O(1) + 3\left( Rank_{N}(X) - Rank_{0}(X) \right) \\
        &amp;= O(\log{N})
\end{aligned}
\]</div>
<blockquote>
<p>可以仔细想想求和式是如何“相消”得到最后的式子的，这里的<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(\sum {\hat{c}_\text{...}}_i\)</span><span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span><span class="arithmatex">\(i\)</span><span class="heti-spacing"> </span></span>并不是在求和式中各自连续的，但是三个<span class="heti-skip"><span class="heti-spacing"> </span>term<span class="heti-spacing"> </span></span>放在一起，则可以囊括<span><span class="heti-spacing"> </span><span class="arithmatex">\(i\in\{1,2,...,N\}\)</span></span></p>
</blockquote>
</div>
<!-- 标题计数器 -->
<link href="/assets/stylesheets/counter.css" rel="stylesheet"/>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
</main>
<footer class="md-footer">
<nav aria-label="页脚" class="md-footer__inner md-grid">
<a aria-label="上一页: Chapter 0 | Amortized Analysis" class="md-footer__link md-footer__link--prev" href="ch0.html">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                上一页
              </span>
<div class="md-ellipsis">
                Chapter 0 | Amortized Analysis
              </div>
</div>
</a>
<a aria-label="下一页: Chapter 2 | Red Black Tree &amp;amp; B+ Tree" class="md-footer__link md-footer__link--next" href="ch2.html">
<div class="md-footer__title">
<span class="md-footer__direction">
                下一页
              </span>
<div class="md-ellipsis">
                Chapter 2 | Red Black Tree &amp; B+ Tree
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2024-2025 <a href="https://github.com/Ader817" rel="noopener" target="_blank">Ader817</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "header.autohide", "navigation.tabs", "navigation.top", "navigation.footer", "navigation.indexes", "navigation.tracking", "navigation.prune", "search.share", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
<script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
<script src="../../assets/javascripts/katex.js"></script>
<script src="../../assets/javascripts/toc.js"></script>
<script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
<script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
</body>
</html>